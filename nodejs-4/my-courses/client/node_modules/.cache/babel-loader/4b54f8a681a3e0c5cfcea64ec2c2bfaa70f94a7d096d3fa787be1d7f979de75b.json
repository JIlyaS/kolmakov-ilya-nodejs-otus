{"ast":null,"code":"function e(_ref) {\n  let {\n    storage: e,\n    sync: t = !1,\n    serialize: r = JSON.stringify,\n    deserialize: n = JSON.parse\n  } = _ref;\n  var a = (a, i) => (t && \"undefined\" != typeof addEventListener && addEventListener(\"storage\", t => {\n    t.storageArea === e && (t.key === a && i(t.newValue), null === t.key && i(null));\n  }), {\n    get(t) {\n      var r = void 0 !== t ? t : e.getItem(a);\n      return void 0 === t && null === r ? void 0 : n(r);\n    },\n    set(t) {\n      e.setItem(a, r(t));\n    }\n  });\n  return a.keyArea = e, a;\n}\nexport { e as storage };","map":{"version":3,"names":["e","_ref","storage","sync","t","serialize","r","JSON","stringify","deserialize","n","parse","a","adapter","i","addEventListener","storageArea","key","newValue","get","getItem","set","setItem","keyArea"],"sources":["/Users/ilakolmakov/kolmakov-ilya-nodejs-otus/nodejs-4/my-courses/client/node_modules/src/storage/index.ts"],"sourcesContent":["import type { StorageAdapter } from '..'\n\nexport interface StorageConfig {\n  storage: Storage\n  sync?: boolean\n  serialize?: (value: any) => string\n  deserialize?: (value: string) => any\n}\n\n/**\n * Generic `Storage` adapter factory\n */\nexport function storage({\n  storage,\n  sync = false,\n  serialize = JSON.stringify,\n  deserialize = JSON.parse,\n}: StorageConfig): StorageAdapter {\n  const adapter: StorageAdapter = <State>(\n    key: string,\n    update: (raw?: any) => any\n  ) => {\n    if (sync && typeof addEventListener !== 'undefined') {\n      addEventListener('storage', (e) => {\n        if (e.storageArea === storage) {\n          if (e.key === key) update(e.newValue)\n\n          // `key` attribute is `null` when the change is caused by the storage `clear()` method\n          if (e.key === null) update(null)\n        }\n      })\n    }\n\n    return {\n      get(value?: string | null) {\n        const item = value !== undefined ? value : storage.getItem(key)\n        return value === undefined && item === null\n          ? undefined\n          : deserialize(item as any)\n      },\n\n      set(value: State) {\n        storage.setItem(key, serialize(value))\n      },\n    }\n  }\n\n  adapter.keyArea = storage\n  return adapter\n}\n"],"mappings":"AAYO,SAASA,EAAAC,IAAA,EAIK;EAAA,IAJL;IAAQC,OAAA,EACtBF,CAAA;IADsBG,IAAA,EAEtBC,CAAA,IAAO;IAFeC,SAAA,EAGtBC,CAAA,GAAYC,IAAA,CAAKC,SAAA;IAHKC,WAAA,EAItBC,CAAA,GAAcH,IAAA,CAAKI;EAAA,IAAAV,IAAA;EAEnB,IAAMW,CAAA,GAA0BC,CAC9BD,CAAA,EACAE,CAAA,MAEIV,CAAA,IAAoC,sBAArBW,gBAAA,IACjBA,gBAAA,CAAiB,WAAYX,CAAA;IACvBA,CAAA,CAAEY,WAAA,KAAgBhB,CAAA,KAChBI,CAAA,CAAEa,GAAA,KAAQL,CAAA,IAAKE,CAAA,CAAOV,CAAA,CAAEc,QAAA,GAGd,SAAVd,CAAA,CAAEa,GAAA,IAAcH,CAAA,CAAO,MAC5B;EAAA,IAIE;IACLK,IAAIf,CAAA;MACF,IAAME,CAAA,QAAiB,MAAVF,CAAA,GAAsBA,CAAA,GAAQJ,CAAA,CAAQoB,OAAA,CAAQR,CAAA;MAC3D,YAAiB,MAAVR,CAAA,IAAgC,SAATE,CAAA,QAC1B,IACAI,CAAA,CAAYJ,CAAA,CALb;IAAA;IAQLe,IAAIjB,CAAA;MACFJ,CAAA,CAAQsB,OAAA,CAAQV,CAAA,EAAKN,CAAA,CAAUF,CAAA,EAChC;IAAA;EAAA;EAKL,OADAQ,CAAA,CAAQW,OAAA,GAAUvB,CAAA,EACXY,CACR;AAAA;AAAA,SAAAZ,CAAA,IAAAE,OAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}