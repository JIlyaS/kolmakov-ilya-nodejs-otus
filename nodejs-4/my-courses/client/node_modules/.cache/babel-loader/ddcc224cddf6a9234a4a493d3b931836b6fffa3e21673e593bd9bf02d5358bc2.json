{"ast":null,"code":"import { createStore, createEffect, createEvent, sample } from \"effector\";\nimport { createGate } from \"effector-react\";\nimport { getCourses, createCourse, getCourse as getCourseApi, deleteCourse as deleteCourseApi } from \"../../api/rest/courses\";\n// import format from \"date-fns/format\";\n// import parse from \"date-fns/parse\";\n// import { Column, TableRow } from \"@admiral-ds/react-ui\";\n\n// import { notificationService } from \"@src/common/services/notification/notification\";\n\n// import { tasksService } from \"./tasks.service\";\n// import { columnList } from \"./utils/constants\";\n// import {\n//   ITask,\n//   ITaskPriorities,\n//   ITaskStatuses,\n//   ITaskTypes,\n//   IUpdateTaskRequest,\n// } from \"./types\";\n\nconst CourseListPageGate = createGate(\"CourseListPage\");\nconst CoursePageGate = createGate(\"CoursePage\");\nconst $courseList = createStore([]);\nconst $currentCourse = createStore(null);\nconst getCourseList = createEvent();\nconst addCourse = createEvent();\nconst getCourse = createEvent();\nconst deleteCourse = createEvent();\nconst getCourseListFx = createEffect(() => getCourses());\n// const createCourseFx = createEffect(() => createCourse());\nconst addCourseFx = createEffect(data => createCourse(data));\nconst getCourseFx = createEffect(id => getCourseApi(id));\nconst deleteCourseFx = createEffect(id => deleteCourseApi(id));\nsample({\n  clock: CourseListPageGate.open,\n  target: getCourseList\n});\nsample({\n  clock: getCourseList,\n  target: getCourseListFx\n});\nsample({\n  clock: addCourse,\n  target: addCourseFx\n});\n$courseList.on(getCourseListFx.doneData, (_, payload) => {\n  return payload;\n});\nsample({\n  clock: CoursePageGate.open,\n  target: getCourse\n});\nsample({\n  clock: getCourse,\n  target: getCourseFx\n});\n$currentCourse.on(getCourseFx.doneData, (_, payload) => {\n  return payload;\n});\nsample({\n  clock: deleteCourse,\n  target: deleteCourseFx\n});\n\n// sample({\n//   clock: getTaskTableList,\n//   target: [\n//     getTaskTableListFx,\n//     getTaskTypesFx,\n//     getTaskStatusesFx,\n//     getTaskPrioritiesFx,\n//   ],\n// });\n\n// const TaskWidgetGate = createGate(\"TaskWidgetGate\");\n\n// const updateStatusTask = createEvent<IUpdateTaskRequest>();\n// const getTaskTableList = createEvent();\n\n// const getTaskTableListFx = createEffect(() => tasksService.getTasks());\n// const getTaskTypesFx = createEffect(() => tasksService.getTaskTypes());\n// const getTaskStatusesFx = createEffect(() => tasksService.getTaskStatuses());\n// const getTaskPrioritiesFx = createEffect(() =>\n//   tasksService.getTaskPriorities()\n// );\n// const updateStatusTaskFx = createEffect((data) =>\n//   tasksService.updateTask(data.numberTask, { statusId: data.numberStatus })\n// );\n\n// const $originTaskRowList = createStore<ITask[]>([]);\n// const $taskTypes = createStore<ITaskTypes[]>([]);\n// const $taskStatuses = createStore<ITaskStatuses[]>([]);\n// const $taskPriorities = createStore<ITaskPriorities[]>([]);\n// const $taskRowList = createStore<TableRow[]>([]);\n// const $taskColumnList = createStore<Column[]>(columnList);\n\n// const $isTaskTableListEmpty = $taskRowList.map((list) => list.length === 0);\n// const $isTasksLoading = getTaskTableListFx.pending;\n// const $isTaskTypesLoading = getTaskTypesFx.pending;\n// const $isTaskStatusesLoading = getTaskStatusesFx.pending;\n// const $isTaskPrioritiesLoading = getTaskPrioritiesFx.pending;\n\n// sample({\n//   clock: updateStatusTask,\n//   target: updateStatusTaskFx,\n// });\n\n// const showErrorFx = createEffect(() => {\n//   notificationService.showErrorNotification(\n//     \"Произошла ошибка, повторите действие позднее\",\n//     \"Ошибка\"\n//   );\n// });\n\n// sample({\n//   clock: getTaskTableListFx.fail,\n//   target: showErrorFx,\n// });\n\n// const $isError = createStore<boolean>(false);\n\n// sample({\n//   clock: showErrorFx.done,\n//   fn: () => true,\n//   target: $isError,\n// });\n\n// sample({\n//   clock: getTaskTableListFx,\n//   fn: () => false,\n//   target: $isError,\n// });\n\n// $originTaskRowList\n//   .on(getTaskTableListFx.doneData, (_, payload) => payload?.content ?? [])\n//   .on(updateStatusTaskFx.doneData, (state) => {\n//     notificationService.showSuccessNotification(\"Задача успешно обновлена\");\n\n//     // TODO: не убирать, нужно проверить функционал на работоспособность, смена статуса\n//     // const currentStateTaskIdx = state.findIndex(\n//     //   (task) => task.number === payload.number\n//     // );\n//     // state[currentStateTaskIdx].statusId = payload.statusId;\n\n//     return [...state];\n//   })\n//   .on(updateStatusTaskFx.fail, (state) => [...state]);\n\n// $taskTypes.on(getTaskTypesFx.doneData, (_, payload) => payload);\n// $taskStatuses.on(getTaskStatusesFx.doneData, (_, payload) => payload);\n// $taskPriorities.on(getTaskPrioritiesFx.doneData, (_, payload) => payload);\n\n// const getTasksSuccessAction = merge([\n//   getTaskTableListFx.doneData,\n//   getTaskTypesFx.doneData,\n//   getTaskStatusesFx.doneData,\n//   getTaskPrioritiesFx.doneData,\n// ]);\n\n// sample({\n//   clock: getTasksSuccessAction,\n//   source: combine(\n//     $originTaskRowList,\n//     $taskTypes,\n//     $taskStatuses,\n//     $taskPriorities,\n//     (originTaskRowList, taskTypes, taskStatuses, taskPriorities) => {\n//       const taskRowList = originTaskRowList.map((task) => {\n//         const currentType = taskTypes.find((type) => type.id === task.typeId);\n//         const currentStatus = taskStatuses.find(\n//           (status) => status.id === task.statusId\n//         );\n//         const currentPriority = taskPriorities.find(\n//           (priority) => priority.id === task.priorityId\n//         );\n\n//         return {\n//           ...task,\n//           id: task.number,\n//           currentType,\n//           currentStatus,\n//           currentPriority,\n//           status: currentStatus?.name,\n//           priority: currentPriority?.name,\n//           dueDate: task?.dueDate\n//             ? format(parse(task.dueDate, \"yyyy-MM-dd\", new Date()), \"dd.MM.yy\")\n//             : \"\",\n//         };\n//       });\n\n//       return taskRowList;\n//     }\n//   ),\n//   target: $taskRowList,\n// });\n\n// sample({\n//   clock: TaskWidgetGate.open,\n//   target: [\n//     getTaskTableListFx,\n//     getTaskTypesFx,\n//     getTaskStatusesFx,\n//     getTaskPrioritiesFx,\n//   ],\n// });\n\n// sample({\n//   clock: getTaskTableList,\n//   target: [\n//     getTaskTableListFx,\n//     getTaskTypesFx,\n//     getTaskStatusesFx,\n//     getTaskPrioritiesFx,\n//   ],\n// });\n\n// export {\n//   TaskWidgetGate,\n//   $taskColumnList,\n//   $taskRowList,\n//   $isTasksLoading,\n//   $isTaskTypesLoading,\n//   $isTaskStatusesLoading,\n//   $isTaskPrioritiesLoading,\n//   $taskTypes,\n//   $taskStatuses,\n//   $taskPriorities,\n//   $isError,\n//   $isTaskTableListEmpty,\n//   getTaskTableList,\n//   updateStatusTask,\n// };\n\nexport { CourseListPageGate, CoursePageGate, $courseList, addCourse, addCourseFx, $currentCourse, deleteCourse, deleteCourseFx };","map":{"version":3,"names":["createStore","createEffect","createEvent","sample","createGate","getCourses","createCourse","getCourse","getCourseApi","deleteCourse","deleteCourseApi","CourseListPageGate","CoursePageGate","$courseList","$currentCourse","getCourseList","addCourse","getCourseListFx","addCourseFx","data","getCourseFx","id","deleteCourseFx","clock","open","target","on","doneData","_","payload"],"sources":["/Users/ilakolmakov/kolmakov-ilya-nodejs-otus/nodejs-4/my-courses/client/src/entities/course/model.ts"],"sourcesContent":["import {\n  createStore,\n  combine,\n  createEffect,\n  createEvent,\n  sample,\n  merge,\n} from \"effector\";\nimport { createGate } from \"effector-react\";\nimport { getCourses, createCourse, getCourse as getCourseApi, deleteCourse as deleteCourseApi } from \"../../api/rest/courses\";\nimport { Course } from \"../../api/rest/courses/types\";\n\n// import format from \"date-fns/format\";\n// import parse from \"date-fns/parse\";\n// import { Column, TableRow } from \"@admiral-ds/react-ui\";\n\n// import { notificationService } from \"@src/common/services/notification/notification\";\n\n// import { tasksService } from \"./tasks.service\";\n// import { columnList } from \"./utils/constants\";\n// import {\n//   ITask,\n//   ITaskPriorities,\n//   ITaskStatuses,\n//   ITaskTypes,\n//   IUpdateTaskRequest,\n// } from \"./types\";\n\nconst CourseListPageGate = createGate(\"CourseListPage\");\nconst CoursePageGate = createGate<string>(\"CoursePage\");\n\nconst $courseList = createStore<Course[]>([]);\nconst $currentCourse = createStore<Course | null>(null);\n\nconst getCourseList = createEvent();\nconst addCourse = createEvent<Course>();\nconst getCourse = createEvent<string>();\nconst deleteCourse = createEvent<string | undefined>();\n\nconst getCourseListFx = createEffect(() => getCourses());\n// const createCourseFx = createEffect(() => createCourse());\nconst addCourseFx = createEffect((data: Course) => createCourse(data));\nconst getCourseFx = createEffect((id: string) => getCourseApi(id));\nconst deleteCourseFx = createEffect((id: string | undefined) => deleteCourseApi(id));\n\nsample({\n  clock: CourseListPageGate.open,\n  target: getCourseList,\n});\n\nsample({\n  clock: getCourseList,\n  target: getCourseListFx,\n});\n\nsample({\n  clock: addCourse,\n  target: addCourseFx,\n});\n\n$courseList.on(getCourseListFx.doneData, (_, payload: any) => {\n  return payload;\n});\n\nsample({\n  clock: CoursePageGate.open,\n  target: getCourse\n});\n\nsample({\n  clock: getCourse,\n  target: getCourseFx,\n});\n\n$currentCourse.on(getCourseFx.doneData, (_, payload: any) => {\n  return payload;\n});\n\nsample({\n  clock: deleteCourse,\n  target: deleteCourseFx\n});\n\n// sample({\n//   clock: getTaskTableList,\n//   target: [\n//     getTaskTableListFx,\n//     getTaskTypesFx,\n//     getTaskStatusesFx,\n//     getTaskPrioritiesFx,\n//   ],\n// });\n\n// const TaskWidgetGate = createGate(\"TaskWidgetGate\");\n\n// const updateStatusTask = createEvent<IUpdateTaskRequest>();\n// const getTaskTableList = createEvent();\n\n// const getTaskTableListFx = createEffect(() => tasksService.getTasks());\n// const getTaskTypesFx = createEffect(() => tasksService.getTaskTypes());\n// const getTaskStatusesFx = createEffect(() => tasksService.getTaskStatuses());\n// const getTaskPrioritiesFx = createEffect(() =>\n//   tasksService.getTaskPriorities()\n// );\n// const updateStatusTaskFx = createEffect((data) =>\n//   tasksService.updateTask(data.numberTask, { statusId: data.numberStatus })\n// );\n\n// const $originTaskRowList = createStore<ITask[]>([]);\n// const $taskTypes = createStore<ITaskTypes[]>([]);\n// const $taskStatuses = createStore<ITaskStatuses[]>([]);\n// const $taskPriorities = createStore<ITaskPriorities[]>([]);\n// const $taskRowList = createStore<TableRow[]>([]);\n// const $taskColumnList = createStore<Column[]>(columnList);\n\n// const $isTaskTableListEmpty = $taskRowList.map((list) => list.length === 0);\n// const $isTasksLoading = getTaskTableListFx.pending;\n// const $isTaskTypesLoading = getTaskTypesFx.pending;\n// const $isTaskStatusesLoading = getTaskStatusesFx.pending;\n// const $isTaskPrioritiesLoading = getTaskPrioritiesFx.pending;\n\n// sample({\n//   clock: updateStatusTask,\n//   target: updateStatusTaskFx,\n// });\n\n// const showErrorFx = createEffect(() => {\n//   notificationService.showErrorNotification(\n//     \"Произошла ошибка, повторите действие позднее\",\n//     \"Ошибка\"\n//   );\n// });\n\n// sample({\n//   clock: getTaskTableListFx.fail,\n//   target: showErrorFx,\n// });\n\n// const $isError = createStore<boolean>(false);\n\n// sample({\n//   clock: showErrorFx.done,\n//   fn: () => true,\n//   target: $isError,\n// });\n\n// sample({\n//   clock: getTaskTableListFx,\n//   fn: () => false,\n//   target: $isError,\n// });\n\n// $originTaskRowList\n//   .on(getTaskTableListFx.doneData, (_, payload) => payload?.content ?? [])\n//   .on(updateStatusTaskFx.doneData, (state) => {\n//     notificationService.showSuccessNotification(\"Задача успешно обновлена\");\n\n//     // TODO: не убирать, нужно проверить функционал на работоспособность, смена статуса\n//     // const currentStateTaskIdx = state.findIndex(\n//     //   (task) => task.number === payload.number\n//     // );\n//     // state[currentStateTaskIdx].statusId = payload.statusId;\n\n//     return [...state];\n//   })\n//   .on(updateStatusTaskFx.fail, (state) => [...state]);\n\n// $taskTypes.on(getTaskTypesFx.doneData, (_, payload) => payload);\n// $taskStatuses.on(getTaskStatusesFx.doneData, (_, payload) => payload);\n// $taskPriorities.on(getTaskPrioritiesFx.doneData, (_, payload) => payload);\n\n// const getTasksSuccessAction = merge([\n//   getTaskTableListFx.doneData,\n//   getTaskTypesFx.doneData,\n//   getTaskStatusesFx.doneData,\n//   getTaskPrioritiesFx.doneData,\n// ]);\n\n// sample({\n//   clock: getTasksSuccessAction,\n//   source: combine(\n//     $originTaskRowList,\n//     $taskTypes,\n//     $taskStatuses,\n//     $taskPriorities,\n//     (originTaskRowList, taskTypes, taskStatuses, taskPriorities) => {\n//       const taskRowList = originTaskRowList.map((task) => {\n//         const currentType = taskTypes.find((type) => type.id === task.typeId);\n//         const currentStatus = taskStatuses.find(\n//           (status) => status.id === task.statusId\n//         );\n//         const currentPriority = taskPriorities.find(\n//           (priority) => priority.id === task.priorityId\n//         );\n\n//         return {\n//           ...task,\n//           id: task.number,\n//           currentType,\n//           currentStatus,\n//           currentPriority,\n//           status: currentStatus?.name,\n//           priority: currentPriority?.name,\n//           dueDate: task?.dueDate\n//             ? format(parse(task.dueDate, \"yyyy-MM-dd\", new Date()), \"dd.MM.yy\")\n//             : \"\",\n//         };\n//       });\n\n//       return taskRowList;\n//     }\n//   ),\n//   target: $taskRowList,\n// });\n\n// sample({\n//   clock: TaskWidgetGate.open,\n//   target: [\n//     getTaskTableListFx,\n//     getTaskTypesFx,\n//     getTaskStatusesFx,\n//     getTaskPrioritiesFx,\n//   ],\n// });\n\n// sample({\n//   clock: getTaskTableList,\n//   target: [\n//     getTaskTableListFx,\n//     getTaskTypesFx,\n//     getTaskStatusesFx,\n//     getTaskPrioritiesFx,\n//   ],\n// });\n\n// export {\n//   TaskWidgetGate,\n//   $taskColumnList,\n//   $taskRowList,\n//   $isTasksLoading,\n//   $isTaskTypesLoading,\n//   $isTaskStatusesLoading,\n//   $isTaskPrioritiesLoading,\n//   $taskTypes,\n//   $taskStatuses,\n//   $taskPriorities,\n//   $isError,\n//   $isTaskTableListEmpty,\n//   getTaskTableList,\n//   updateStatusTask,\n// };\n\nexport { \n  CourseListPageGate,\n  CoursePageGate,\n  $courseList, \n  addCourse, \n  addCourseFx,\n  $currentCourse,\n  deleteCourse,\n  deleteCourseFx\n};\n"],"mappings":"AAAA,SACEA,WAAW,EAEXC,YAAY,EACZC,WAAW,EACXC,MAAM,QAED,UAAU;AACjB,SAASC,UAAU,QAAQ,gBAAgB;AAC3C,SAASC,UAAU,EAAEC,YAAY,EAAEC,SAAS,IAAIC,YAAY,EAAEC,YAAY,IAAIC,eAAe,QAAQ,wBAAwB;AAG7H;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMC,kBAAkB,GAAGP,UAAU,CAAC,gBAAgB,CAAC;AACvD,MAAMQ,cAAc,GAAGR,UAAU,CAAS,YAAY,CAAC;AAEvD,MAAMS,WAAW,GAAGb,WAAW,CAAW,EAAE,CAAC;AAC7C,MAAMc,cAAc,GAAGd,WAAW,CAAgB,IAAI,CAAC;AAEvD,MAAMe,aAAa,GAAGb,WAAW,EAAE;AACnC,MAAMc,SAAS,GAAGd,WAAW,EAAU;AACvC,MAAMK,SAAS,GAAGL,WAAW,EAAU;AACvC,MAAMO,YAAY,GAAGP,WAAW,EAAsB;AAEtD,MAAMe,eAAe,GAAGhB,YAAY,CAAC,MAAMI,UAAU,EAAE,CAAC;AACxD;AACA,MAAMa,WAAW,GAAGjB,YAAY,CAAEkB,IAAY,IAAKb,YAAY,CAACa,IAAI,CAAC,CAAC;AACtE,MAAMC,WAAW,GAAGnB,YAAY,CAAEoB,EAAU,IAAKb,YAAY,CAACa,EAAE,CAAC,CAAC;AAClE,MAAMC,cAAc,GAAGrB,YAAY,CAAEoB,EAAsB,IAAKX,eAAe,CAACW,EAAE,CAAC,CAAC;AAEpFlB,MAAM,CAAC;EACLoB,KAAK,EAAEZ,kBAAkB,CAACa,IAAI;EAC9BC,MAAM,EAAEV;AACV,CAAC,CAAC;AAEFZ,MAAM,CAAC;EACLoB,KAAK,EAAER,aAAa;EACpBU,MAAM,EAAER;AACV,CAAC,CAAC;AAEFd,MAAM,CAAC;EACLoB,KAAK,EAAEP,SAAS;EAChBS,MAAM,EAAEP;AACV,CAAC,CAAC;AAEFL,WAAW,CAACa,EAAE,CAACT,eAAe,CAACU,QAAQ,EAAE,CAACC,CAAC,EAAEC,OAAY,KAAK;EAC5D,OAAOA,OAAO;AAChB,CAAC,CAAC;AAEF1B,MAAM,CAAC;EACLoB,KAAK,EAAEX,cAAc,CAACY,IAAI;EAC1BC,MAAM,EAAElB;AACV,CAAC,CAAC;AAEFJ,MAAM,CAAC;EACLoB,KAAK,EAAEhB,SAAS;EAChBkB,MAAM,EAAEL;AACV,CAAC,CAAC;AAEFN,cAAc,CAACY,EAAE,CAACN,WAAW,CAACO,QAAQ,EAAE,CAACC,CAAC,EAAEC,OAAY,KAAK;EAC3D,OAAOA,OAAO;AAChB,CAAC,CAAC;AAEF1B,MAAM,CAAC;EACLoB,KAAK,EAAEd,YAAY;EACnBgB,MAAM,EAAEH;AACV,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SACEX,kBAAkB,EAClBC,cAAc,EACdC,WAAW,EACXG,SAAS,EACTE,WAAW,EACXJ,cAAc,EACdL,YAAY,EACZa,cAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}