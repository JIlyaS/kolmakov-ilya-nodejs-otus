{"ast":null,"code":"import { createEffect, createEvent, createStore, sample } from \"effector\";\nimport { persist } from 'effector-storage/local';\nimport { getUsers as getUsersApi, getUser as getUserApi } from \"../../api/rest/users\";\nimport { loginUserFx } from \"../auth/model\";\nconst $userId = createStore(null);\nconst $currentUser = createStore(null);\nconst $roles = createStore([]);\nconst getUsers = createEvent();\nconst getUser = createEvent();\nconst getUsersFx = createEffect(() => getUsersApi());\nconst getUserFx = createEffect(id => getUserApi(id));\nsample({\n  clock: loginUserFx.doneData,\n  fn: data => data.data.userId,\n  target: $userId\n});\npersist({\n  store: $userId,\n  key: 'userId'\n});\nsample({\n  clock: getUsers,\n  target: getUsersFx\n});\nsample({\n  clock: getUser,\n  target: getUserFx\n});\nsample({\n  clock: $currentUser,\n  fn: data => {\n    var _data$roles;\n    return (_data$roles = data === null || data === void 0 ? void 0 : data.roles) !== null && _data$roles !== void 0 ? _data$roles : [];\n  },\n  target: $roles\n});\npersist({\n  store: $roles,\n  key: 'roles'\n});\n\n//   sample({\n//     clock: getUserFx.doneData,\n//     target\n//     fn: (data) => {\n//         localStorage.setItem(\"roles\", JSON.stringify(data.data.roles));\n//     }\n//   });\n\nexport { getUser, $userId, $roles };","map":{"version":3,"names":["createEffect","createEvent","createStore","sample","persist","getUsers","getUsersApi","getUser","getUserApi","loginUserFx","$userId","$currentUser","$roles","getUsersFx","getUserFx","id","clock","doneData","fn","data","userId","target","store","key","_data$roles","roles"],"sources":["/Users/ilakolmakov/kolmakov-ilya-nodejs-otus/nodejs-4/my-courses/client/src/entities/user/model.ts"],"sourcesContent":["import {\n    createEffect,\n    createEvent,\n    createStore,\n    sample,\n  } from \"effector\";\n  import { persist } from 'effector-storage/local';\n\n  import { getUsers as getUsersApi, getUser as getUserApi } from \"../../api/rest/users\";\n  import { Role, User } from \"../../api/rest/users/types\";\n  import { loginUserFx } from \"../auth/model\";\n\n  const $userId = createStore<string | null>(null);\n  const $currentUser = createStore<User | null>(null);\n  const $roles = createStore<Role[]>([]);\n  \n  const getUsers = createEvent();\n  const getUser = createEvent<string>();\n  \n  const getUsersFx = createEffect(() => getUsersApi());\n  const getUserFx = createEffect((id: string) => getUserApi(id));\n  \n  sample({\n    clock: loginUserFx.doneData,\n    fn: (data) => data.data.userId, \n    target: $userId\n  });\n\n  persist({ store: $userId, key: 'userId' })\n  \n  \n  sample({\n    clock: getUsers,\n    target: getUsersFx,\n  });\n  \n  sample({\n    clock: getUser,\n    target: getUserFx,\n  });\n\n  sample({\n    clock: $currentUser,\n    fn: (data) => data?.roles ?? [],\n    target: $roles \n  });\n\n  persist({\n    store: $roles,\n    key: 'roles'\n  });\n\n//   sample({\n//     clock: getUserFx.doneData,\n//     target\n//     fn: (data) => {\n//         localStorage.setItem(\"roles\", JSON.stringify(data.data.roles));\n//     }\n//   });\n  \n  export { getUser, $userId, $roles };\n  "],"mappings":"AAAA,SACIA,YAAY,EACZC,WAAW,EACXC,WAAW,EACXC,MAAM,QACD,UAAU;AACjB,SAASC,OAAO,QAAQ,wBAAwB;AAEhD,SAASC,QAAQ,IAAIC,WAAW,EAAEC,OAAO,IAAIC,UAAU,QAAQ,sBAAsB;AAErF,SAASC,WAAW,QAAQ,eAAe;AAE3C,MAAMC,OAAO,GAAGR,WAAW,CAAgB,IAAI,CAAC;AAChD,MAAMS,YAAY,GAAGT,WAAW,CAAc,IAAI,CAAC;AACnD,MAAMU,MAAM,GAAGV,WAAW,CAAS,EAAE,CAAC;AAEtC,MAAMG,QAAQ,GAAGJ,WAAW,EAAE;AAC9B,MAAMM,OAAO,GAAGN,WAAW,EAAU;AAErC,MAAMY,UAAU,GAAGb,YAAY,CAAC,MAAMM,WAAW,EAAE,CAAC;AACpD,MAAMQ,SAAS,GAAGd,YAAY,CAAEe,EAAU,IAAKP,UAAU,CAACO,EAAE,CAAC,CAAC;AAE9DZ,MAAM,CAAC;EACLa,KAAK,EAAEP,WAAW,CAACQ,QAAQ;EAC3BC,EAAE,EAAGC,IAAI,IAAKA,IAAI,CAACA,IAAI,CAACC,MAAM;EAC9BC,MAAM,EAAEX;AACV,CAAC,CAAC;AAEFN,OAAO,CAAC;EAAEkB,KAAK,EAAEZ,OAAO;EAAEa,GAAG,EAAE;AAAS,CAAC,CAAC;AAG1CpB,MAAM,CAAC;EACLa,KAAK,EAAEX,QAAQ;EACfgB,MAAM,EAAER;AACV,CAAC,CAAC;AAEFV,MAAM,CAAC;EACLa,KAAK,EAAET,OAAO;EACdc,MAAM,EAAEP;AACV,CAAC,CAAC;AAEFX,MAAM,CAAC;EACLa,KAAK,EAAEL,YAAY;EACnBO,EAAE,EAAGC,IAAI;IAAA,IAAAK,WAAA;IAAA,QAAAA,WAAA,GAAKL,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEM,KAAK,cAAAD,WAAA,cAAAA,WAAA,GAAI,EAAE;EAAA;EAC/BH,MAAM,EAAET;AACV,CAAC,CAAC;AAEFR,OAAO,CAAC;EACNkB,KAAK,EAAEV,MAAM;EACbW,GAAG,EAAE;AACP,CAAC,CAAC;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEE,SAAShB,OAAO,EAAEG,OAAO,EAAEE,MAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}